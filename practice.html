<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quran Topics Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<div class="container py-5">
  <h3 class="mb-4">Search Quran Topics</h3>

  <!-- Search Field -->
  <div class="mb-4">
    <input type="search" id="searchBox" class="form-control" placeholder="Search by topic name...">
 <button id="searchbtn">Search Now</button>
  </div>

  <!-- Results -->
   <div id="pagin_bnt_of_subject">

   </div>
  <div id="english_subjects"></div>
</div>

<script>
const english_subjects = document.getElementById("english_subjects");
const pagin_bnt_of_subject = document.getElementById("pagin_bnt_of_subject");
const searchBox = document.getElementById("searchBox");

let page = 1;

// 🟡 Search button
document.getElementById("searchbtn").addEventListener("click", () => {
  const query = searchBox.value.trim();
  pages(1, query);
});

// 🔁 Main fetch function
function pages(params = 1, query = "") {
  page = params;
  const isSearching = query !== "";

  const apiUrl = isSearching
    ? `https://subjectsofalquran.com/api/topics/search?q=${query}&page=${page}`
    : `https://subjectsofalquran.com/api/topics?page=${page}`;

  fetch(apiUrl, {
    headers: {
      Authorization: "Bearer b1e2f3a4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2",
      "Content-Type": "application/json",
    },
  })
    .then((res) => res.json())
    .then((datas) => {
      console.log("DATA:", datas);

      english_subjects.innerHTML = "";
      pagin_bnt_of_subject.innerHTML = "";

      // 🟢 Render topics
      datas.data.forEach((element) => {
        english_subjects.innerHTML += `
          <div class="accordion accordion-flush">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#flush-collapse${element.id}"
                  aria-expanded="false"
                  aria-controls="flush-collapse${element.id}">
                  ${element.topicname}
                </button>
              </h2>
            </div>
          </div>
        `;
      });


      for (let i = 1; i <= datas.last_page; i++) {
        pagin_bnt_of_subject.innerHTML += `
          <button class="btn btn-outline-primary m-1 btn_pagin" onclick="pages(${i}, '${query}')">
            ${i}
          </button>`;
      }
    })
    .catch((err) => console.error("API ERROR:", err));
}

// 🔃 Load first page
pages();
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
