<!DOCTYPE html>
<html>
<head>
  <title>Simple Quran Topics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container my-4">
  <div id="english_subjects"></div>
  <div id="pagination_buttons" class="mt-3"></div>
  <div id="loader" style="display:none;">Loading...</div>
</div>

<script>
  var english_subjects = document.getElementById("english_subjects");
  var pagination_buttons = document.getElementById("pagination_buttons");
  var loader = document.getElementById("loader");

  var headers = {
    "Authorization": "Bearer b1e2f3a4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2",
    "Content-Type": "application/json"
  };

  function loadTopics(page) {
    if (!page) page = 1;

    english_subjects.innerHTML = "";
    pagination_buttons.innerHTML = "";
    loader.style.display = "block";

    // Get topic list
    fetch("https://subjectsofalquran.com/api/topics?page=" + page, {
      method: "GET",
      headers: headers
    })
    .then(function(res) {
      return res.json();
    })
    .then(function(data) {
      var topics = data.data;
      var totalTopics = topics.length;
      var index = 0;

      // Get one-by-one topic details
      function loadNext() {
        if (index >= totalTopics) {
          loader.style.display = "none";
          // Pagination buttons
          for (var i = 1; i <= data.last_page; i++) {
            pagination_buttons.innerHTML += '<button class="btn btn-sm btn-primary m-1" onclick="loadTopics(' + i + ')">' + i + '</button>';
          }
          return;
        }

        var topic = topics[index];

        fetch("https://subjectsofalquran.com/api/topicdetails/topic/" + topic.id, {
          method: "GET",
          headers: headers
        })
        .then(function(res2) {
          return res2.json();
        })
        .then(function(detailData) {
          var details = detailData.data;
          var joinedDetails = "";

         for (var d = 0; d < details.length; d++) {
            console.log(details[d].topicdetail.split(",").slice(0,details[d].topicdetail.length));
            
  if (details[d].topicdetail && details[d].surah && details[d].surah.id ) {
    var surahNumber = details[d].surah.id;
    var surahName = details[d].surah.surahname;
    var ayahNumber = details[d].ayah_number;
    var topicDetail = details[d].topicdetail;

    joinedDetails += `
      <p>
        <span class="fw-bold">Surah:</span>
        <a href="The_List_of_Subjects_detail.html?surah=${surahNumber}" target="_blank">
          ${surahName}
        </a>
      </p>
      <p>
        <span class="fw-bold">Ayah Number:</span>
        <a href="The_List_of_Subjects.html?surah=${surahNumber}&ayah=${ayahNumber}" target="_blank">
          ${topicDetail}
        </a>
      </p>
      <hr>
    `;
  }
}

          var accordionHTML = `
            <div class="accordion mb-3" id="accordion-${topic.id}">
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading-${topic.id}">
                  <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse-${topic.id}"
                    aria-expanded="false"
                    aria-controls="collapse-${topic.id}">
                    <h1 class="fs-5 m-0">${topic.topicname}</h1>
                  </button>
                </h2>
                <div id="collapse-${topic.id}" class="accordion-collapse collapse"
                  aria-labelledby="heading-${topic.id}" data-bs-parent="#accordion-${topic.id}">
                  <div class="accordion-body">
                    ${joinedDetails || "<p>No details found.</p>"}
                  </div>
                </div>
              </div>
            </div>
          `;

          english_subjects.innerHTML += accordionHTML;
          index++;
          loadNext(); // next one
        });
      }

      loadNext();
    })
    .catch(function() {
      loader.style.display = "none";
      english_subjects.innerHTML = "<p style='color:red;'>Error loading topics. Please try again.</p>";
    });
  }

  // Load first page
  loadTopics(1);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
